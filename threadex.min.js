function postSuccess(a,b){$("#progressbar").hide(),a?a.error?alert(a.error):b(a):alert("No results for request")}function postError(){$("#progressbar").hide(),alert("Error processing request; please try again")}function postResults(a,b,c){var d,e,f,g="http://data.rcc-acis.org"+b;window.XDomainRequest?(d=new XDomainRequest,d.open("GET",g+"?params="+JSON.stringify(a)),d.onload=function(){f=JSON.parse(d.responseText),postSuccess(f,c)},d.onerror=postError,d.onprogress=function(){},d.ontimeout=function(){},setTimeout(function(){d.send()},0)):(e={params:JSON.stringify(a),output:"json"},$.ajax(g,{type:"POST",data:e,dataType:"json",crossDamain:!0,success:function(a){postSuccess(a,c)},error:postError}))}function urlopts(){var a,b,c={},d=["himaxt","lomaxt","himint","lomint","hipcpn","archivehimaxt","archivelomaxt","archivehimint","archivelomint","archivehipcpn","changes","covmaxt","covmint","covpcpn","thread"],e=window.location.search.slice(1),f=e.split("&");for(a=0;a<f.length;a+=1)b=f[a].split("="),("thr_id"===b[0]&&6===b[1].length||"variable"===b[0]&&$.inArray(b[1].toLowerCase(),d)>=0)&&(c[b[0]]=b[1]);return c}function fixTraces(a){var b,c,d,e,f,g,h=$("#selected_report").text(),i=a.meta.valid_daterange[0],j=function(a){return a%4===0&&a%100!==0||a%400===0},k=function(a){var b,c,d,e,f,g,h,i=[],j=[],k=[],l=$.grep(a.data,function(a,b){return a[0].search("-02-29")>0});for(l.length&&(a.data=l),b=a.data.length-1;b>=0;b-=1)d=a.data[b][0],e=a.data[b][1],"T"===e?i.push([e,d]):"0.00"===e?j.push([e,d]):"M"!=e&&k.push([e,d]);for($.merge($.merge(k,i),j),c=0;c<=2;c+=1)g=k.shift(),"0.00"!==g[0]&&"T"!==g[0]||(h=("T"===g[0]?"Trace":g[0])+" in "+g[1].slice(0,4),f=g[1].split("-"),2===c&&(nxtval=k.shift(),nxtval[0]===g[0]&&(h+="+")),$("#results_table tbody tr td").filter(function(){return $(this).text()===parseInt(f[1])+"/"+parseInt(f[2])}).closest("tr").find("td").eq(c+1).text(h))};if(h.search("precipitation")>=0)for(b=0;b<366;b+=1)if(c=a.smry[0][b],"0.00"===c[2][0]||"T"===c[2][0]){if(d=c[0][1].split("-"),e=parseInt(i[0].split("-")[0]),f=parseInt(i[1].split("-")[0]),2===parseInt(d[1])&&29===parseInt(d[2])){for(;!j(e);)e-=1;for(;!j(f);)f+=1}g={sid:$("#thr_id").val(),sdate:e.toString()+"-"+d[1]+"-"+d[2],edate:f.toString()+"-"+d[1]+"-"+d[2],elems:[{name:"pcpn",interval:[1,0,0],duration:1}],meta:[]},postResults(g,"/StnData",k)}}function addGraph(a,b){$("#results_area").append('<div id="chart-container"></div>'),Highcharts.chart("chart-container",{chart:{type:"columnrange",inverted:!0,zoomType:"xy",spacingBottom:20,borderWidth:1},title:{text:"Range Between 1st and 3rd Record Values",style:{fontSize:"14px"}},subtitle:{text:"Click and drag to zoom in"},credits:{text:"Powered by ACIS",href:"http://www.rcc-acis.org"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %e"},gridLineWidth:1,showLastLabel:!1},yAxis:{title:{text:b},floor:b.search("precipitation")>=0?0:null},legend:{enabled:!1},tooltip:{dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %e"},valueDecimals:b.search("precipitation")>=0?2:0,formatter:function(){return"Range of records for "+Highcharts.dateFormat("%b %e",new Date(this.x))+": "+this.point.low+" to "+this.point.high}},series:[{name:"Range of records",data:a,pointStart:Date.UTC(2016,0,1),pointInterval:864e5}]})}function addToGraphSeries(a,b,c){var d=a[0][0],e=a[2][0];return d===e&&c.search("temperature")>=0?c.search("Highest")>=0?b.push([parseFloat(d)+.2,parseFloat(e)-.2]):b.push([parseFloat(d)-.2,parseFloat(e)+.2]):(d=c.search("precipitation")>=0&&("T"===d||"Trace"===d)?0:parseFloat(d),e=c.search("precipitation")>=0&&("T"===e||"Trace"===e)?0:parseFloat(e),b.push([d,e])),b}function displayRecords(a){var b,c,d,e,f,g,h=!1,i=a.meta,j=$("#selected_report").text(),k=j+(j.search("temperature")>=0?" (degrees F)":" (inches)"),l=[];for($("#results_area").append('<table id="results_table" class="abreast"><caption></caption><thead></thead><tbody></tbody><tfoot></tfoot></table>'),$("#results_table caption").append(i.name+", "+i.state+'<br /><span class="subcaption">Period of record: '+i.valid_daterange[0][0]+" through "+i.valid_daterange[0][1]+"</span>"),$("#results_table thead").append("<tr><th rowspan=2>Date<th colspan=3>"+k+"</tr><tr><th>Top Record <th>2nd Record <th>3rd Record</tr>"),b=0;b<366;b+=1)c=a.smry[0][b],d=c[0][1].split("-"),f=parseInt(d[1])%2===1?"WhiteSmoke":"white",c[2][0]===c[3][0]?(g="+",h=!0):g="",e='<tr style="background-color: '+f+';"><td>'+parseInt(d[1])+"/"+parseInt(d[2]),e+="<td>"+("T"===c[0][0]||"0.00"===c[0][0]?"processing":c[0][0]+" in "+d[0]),e+="<td>"+("T"===c[1][0]||"0.00"===c[1][0]?"processing":c[1][0]+" in "+c[1][1].slice(0,4)),e+="<td>"+("T"===c[2][0]||"0.00"===c[2][0]?"processing":c[2][0]+" in "+c[2][1].slice(0,4)+g)+"</tr>",$("#results_table tbody").append(e),l=addToGraphSeries(c,l,k);h&&$("#results_area tfoot").append("<tr><td colspan=4>+ indicates same value also occurred in a previous year.</tr>"),fixTraces(a),addGraph(l,k)}function displayCoverage(a){var b,c,d,e,f,g,h,i=a.meta,j=a.data,k=$("#selected_report").text().replace("data coverage"," - Missing days per month"),l=function(a,b){return new Date(parseInt(a),b+1,0).getDate()};for($("#results_area").append('<table id="results_table" class="coverage_table"><caption></caption><thead></thead><tbody></tbody></table>'),$("#results_table caption").append(i.name+", "+i.state),$("#results_table thead").append("<tr><th rowspan=2>Year<th colspan=12>"+k+"</tr><tr><th>Jan<th>Feb<th>Mar<th>Apr<th>May<th>Jun<th>Jul<th>Aug<th>Sep<th>Oct<th>Nov<th>Dec</tr>"),b=0;b<j.length;b+=1){for(h=j[b][0],d=j[b][1],g="",c=0;c<12;c+=1)"M"===d[c]?(e=l(h,c),f="red"):0===d[c][1]?(e="-",f="green"):(e=d[c][1],f=d[c][1]===l(h,c)?"red":"yellow"),g+='<td style="background-color:'+f+';">'+e+"</td>";$("#results_table tbody").append("<tr><td>"+h+"</td>"+g+"</tr>")}}function displayArchiveRecords(a,b,c){var d,e,f,g,h,i,j=!1,k=$("#report").val(),l="None selected"!==$("#selected_station").text()?$("#selected_station").text():$("#thr_id").find(".ui-menu-item[data-value='"+$("#thr_id").val()+"']").text(),m=l.split(" - "),n=$("#selected_report").text(),o=n+(n.search("temperature")>=0?" (degrees F)":" (inches)"),p=[];for($("#results_area").append('<table id="results_table" class="abreast"><caption></caption><thead></thead><tbody></tbody><tfoot></tfoot></table>'),$("#results_table caption").append(m[1]+" Area, "+m[0]+'<br /><span class="subcaption">Version: '+b+" (created "+c+')</span><br /><span class="subcaption">Period of record: '+a.start_yr+" through "+a.end_yr+"</span>"),$("#results_table thead").append("<tr><th rowspan=2>Date<th colspan=3>"+o+"</tr><tr><th>Top Record <th>2nd Record <th>3rd Record</tr>"),d=0;d<366;d+=1)e=a.data[d],f=e[0][1].split("-"),h=parseInt(f[1])%2===1?"WhiteSmoke":"white",e[3]?(i="+",j=!0):i="","archivehipcpn"===k&&(e[0][0]=e[0][0]===-1?"Trace":e[0][0].toFixed(2),e[1][0]=e[1][0]===-1?"Trace":e[1][0].toFixed(2),e[2][0]=e[2][0]===-1?"Trace":e[2][0].toFixed(2)),g='<tr style="background-color: '+h+';"><td>'+parseInt(f[1])+"/"+parseInt(f[2]),g+="<td>"+e[0][0]+" in "+f[0],g+="<td>"+e[1][0]+" in "+e[1][1].slice(0,4),g+="<td>"+e[2][0]+" in "+e[2][1].slice(0,4)+i+"</tr>",$("#results_table tbody").append(g),p=addToGraphSeries(e,p,o);j&&$("#results_area tfoot").append("<tr><td colspan=4>+ indicates same value also occurred in a previous year.</tr>"),addGraph(p,o)}function initChangeTable(a,b){var c="None selected"!==$("#selected_station").text()?$("#selected_station").text():$("#thr_id").find(".ui-menu-item[data-value='"+$("#thr_id").val()+"']").text(),d=c.split(" - "),e={himaxt:"Highest maximum temperature (deg F)",lomint:"Lowest minimum temperature (deg F)",lomaxt:"Lowest maximum temperature (deg F)",himint:"Highest minimum temperature (deg F)",hipcpn:"Highest precipitation (inches)"};$("#results_area").append('<table id="results_table" style="display:none;"><caption></caption></table>'),$("#results_table caption").append("ThreadEx Record Changes From Version "+a+" to "+("Current"!==b?"Version ":"")+b+" for "+d[1]+" Area, "+d[0]+'<br /><span class="subcaption">Current'+("Current"!==b?" Version "+b+"; ":"; ")+'Period of record: <span id="lsy"></span> - <span id="ley"></span></span><br /><span class="subcaption">Previous Version: '+a+'; Period of record: <span id="psy"></span> - <span id="pey"></span></span>'),$.each(e,function(a,b){$("#results_table").append('<tbody id="'+a+'"></tbody>'),$("#"+a).append('<tr style="background-color:WhiteSmoke;"><th colspan=5>'+b+"</tr>")})}function displayChanges(a,b,c){var d,e,f,g,h,i,j,k;if($("#psy").text(c[0]),$("#pey").text(c[1]),$("#lsy").text(c[2]),$("#ley").text(c[3]),$("#results_table").show(),0===b.length)$("#"+a).append("<tr><td colspan=5>None</tr>");else for($("#"+a).append('<tr style="background-color:WhiteSmoke;"><th>Date<th>Current Record <th>Year <th>Previous Record <th>Year</tr>'),d=0;d<b.length;d+=1)e=b[d][0],g=b[d][2],i=b[d][4],"hipcpn"===e?(f="Trace"===b[d][1]?"Trace":b[d][1].toFixed(2),h="Trace"===b[d][3]?"Trace":b[d][3].toFixed(2)):(f=b[d][1],h=b[d][3]),j=f!==h?"red":"black",k=f===h?"red":"black",$("#"+e).append("<tr><td>"+parseInt(g[1])+"/"+parseInt(g[2])+'<td style="color:'+j+';">'+f+'<td style="color:'+k+';">'+g[0]+"<td>"+h+"<td>"+i[0]+"</tr>");"hipcpn"===a&&$("#progressbar").hide()}function displayThreads(a){var b,c="None selected"!==$("#selected_station").text()?$("#selected_station").text():$("#thr_id").find(".ui-menu-item[data-value='"+$("#thr_id").val()+"']").text(),d=c.split(" - ");for($("#results_area").append('<table id="results_table" class="threads_table"><caption></caption><thead></thead><tbody></tbody></table>'),$("#results_table caption").append("Station Thread for "+d[1]+" Area, "+d[0]),$("#results_table thead").append("<tr><th><th>Name<th>Period in Thread</tr>"),b=0;b<a.length;b+=1)$("#results_table tbody").append("<tr><td>"+(b+1)+"<td>"+a[b].name+"<td>"+a[b].period+"</tr>")}function getCoverage(){var a={sid:$("#thr_id").val(),sdate:"por",edate:"por",elems:[{name:$("#report").val().slice(-4),interval:"mly",duration:"mly",reduce:{reduce:"cnt_ge_-999",add:"mcnt"},groupby:["year"]}],meta:["name","state","valid_daterange"]};postResults(a,"/StnData",displayCoverage)}function getRecords(){var a={sid:$("#thr_id").val(),sdate:"por",edate:"por",elems:[{name:$("#report").val().slice(-4),interval:"dly",duration:"dly",smry:{reduce:"hi"===$("#report").val().slice(-6,-4)?"max":"min",add:"date",n:4},smry_only:1,groupby:["year","01-01","12-31"]}],meta:["name","state","valid_daterange"]};postResults(a,"/StnData",displayRecords)}function getArchiveRecords(){var a=$("#thr_id").val(),b=$("#report").val().replace("archive","");$.get("./"+latest_version_directory+"/"+b+"_records.json",function(b){$("#progressbar").hide(),displayArchiveRecords(b[a],b.version,b.creationdate)})}function getChanges(){var a=$("#thr_id").val(),b=9999,c=0,d=9999,e=0;initChangeTable(prev_version_directory.substr(6),latest_version_directory.substr(6)),$.each(["himaxt","lomint","lomaxt","himint","hipcpn"],function(f,g){var h,i,j,k,l,m,n,o=[],p=[];$.get("./"+latest_version_directory+"/"+g+"_records.json",function(f){i=f[a],b=Math.min(b,parseInt(i.start_yr)),c=Math.max(c,parseInt(i.end_yr)),$.get("./"+prev_version_directory+"/"+g+"_records.json",function(f){for(l=f[a],d=Math.min(d,l.start_yr),e=Math.max(e,l.end_yr),h=0;h<366;h+=1)j=i.data[h][0][0],"hipcpn"===g&&j===-1&&(j="Trace"),k=i.data[h][0][1].split("-"),m=l.data[h][0][0],"hipcpn"===g&&m===-1&&(m="Trace"),n=l.data[h][0][1].split("-"),j===m&&k[0]===n[0]||o.push([g,j,k,m,n]);p=[d,e,b,c],displayChanges(g,o,p)})})})}function getRecentChanges(){var a=9999,b=0,c=9999,d=0,e=$("#thr_id").val(),f={sid:e,sdate:"por",edate:"por",elems:[{name:null,interval:"dly",duration:"dly",smry:{reduce:null,add:"date"},smry_only:1,groupby:["year","01-01","12-31"]}],meta:["name","state","valid_daterange"]};initChangeTable(latest_version_directory.substr(6),"Current"),$.each(["himaxt","lomint","lomaxt","himint","hipcpn"],function(g,h){var i,j,k,l,m,n,o=[];$.get("./"+latest_version_directory+"/"+h+"_records.json",function(g){j=g[e],a=Math.min(a,parseInt(j.start_yr)),b=Math.max(b,parseInt(j.end_yr)),f.elems[0].name=h.slice(-4),f.elems[0].smry.reduce="hi"===h.slice(-6,-4)?"max":"min",postResults(f,"/StnData",function(e){var f=e.meta.valid_daterange[0][0].split("-"),g=e.meta.valid_daterange[0][1].split("-");for(c=Math.min(c,parseInt(f[0])),d=Math.max(d,parseInt(g[0])),i=0;i<366;i+=1)k=j.data[i][0][0],"hipcpn"===h&&k===-1&&(k="Trace"),l=j.data[i][0][1].split("-"),m="hipcpn"===h&&"T"===e.smry[0][i][0]?"Trace":parseFloat(e.smry[0][i][0]),n=e.smry[0][i][1].split("-"),k===m&&l[0]===n[0]||o.push([h,m,n,k,l]);yr_arr=[a,b,c,d],displayChanges(h,o,yr_arr)})})})}function getThreads(){var a=$("#thr_id").val().slice(0,3);$.get("./data/threads_dict.json",function(b){$("#progressbar").hide(),displayThreads(b[a])})}var latest_version_directory="data/v11.1",prev_version_directory="data/v10.1";$(function(){var a=function(a,b){var c=$(this).prev("button");return b.item.attr("class").search("noselect")>=0?($(this).trigger("click"),!1):(c.show().text(c.text().replace("Select","Change")),$(this).val(b.item.data("value")).hide(),$(this).parent().find("span").html(b.item.text()),void $("#results_area").empty())};$("#thr_id").val("BHMthr").menu({select:a}),$("#report").val("thread").menu({items:"> :not(.ui-widget-header)",select:a}),$(".show_menu").button().on("click",function(){$(this).next("ul").show(),$(this).prev("span").empty(),$(this).hide()}),$("#go").button().on("click",function(){var a=$("#report").val();$("#results_area").empty(),$("#progressbar").show(),$.inArray(a,["himaxt","lomaxt","himint","lomint","hipcpn"])>=0?getRecords():$.inArray(a,["archivehimaxt","archivelomaxt","archivehimint","archivelomint","archivehipcpn"])>=0?getArchiveRecords():"changes"===a?getChanges():"recentchanges"===a?getRecentChanges():$.inArray(a,["covmaxt","covmint","covpcpn"])>=0?getCoverage():"thread"===a?getThreads():($("#results_area").append("<p>Selection not implemented</p>"),$("#progressbar").hide())}),$("#progressbar").progressbar({value:!1,disabled:!0}),$("#info").dialog({autoOpen:!1,modal:!0,width:.9*$(window).width(),maxHeight:.9*$(window).height(),position:{my:"center top",at:"center top",of:$("div.option-container")},buttons:[{text:"Close",click:function(){$(this).dialog("close")}}]}),$("#about").button().on("click",function(){$("#info").load("./help/about.html").dialog("option","title","Project Information").dialog("open")}),$("#report_info").on("click",function(){$("#info").load("./help/report_help.html").dialog("option","title","Report Options").dialog("open")}),$.ui.dialog.prototype._focusTabbable=$.noop;var b=urlopts();"thr_id"in b&&"variable"in b&&(b.thr_id=b.thr_id.substr(0,3).toUpperCase()+b.thr_id.substr(3).toLowerCase(),$("#thr_id").val(b.thr_id),$("#selected_station").text($("#thr_id li[data-value="+b.thr_id+"]").text()),b.variable=b.variable.toLowerCase(),$("#report").val(b.variable),$("#selected_report").text($("#report li[data-value="+b.variable+"]").text()),$("#go").trigger("click"))});